{
    "id": "org.freedesktop.LinuxAudio.Plugins.ZynFusion",
    "branch": "21.08",
    "runtime": "org.freedesktop.LinuxAudio.BaseExtension",
    "runtime-version": "21.08",
    "sdk": "org.freedesktop.Sdk//21.08",
    "build-extension": true,
    "appstream-compose": false,
    "cleanup": [
        "/bin/pyth*",
        "/bin/pip*",
        "/bin/*.py",
        "/lib/python2.7",
        "/lib/libpython*",
        "/lib/lv2"
    ],
    "build-options": {
        "prefix": "/app/extensions/Plugins/ZynFusion",
        "prepend-path": "/app/extensions/Plugins/ZynFusion/bin",
        "prepend-ld-library-path": "/app/extensions/Plugins/ZynFusion/lib",
        "prepend-pkg-config-path": "/app/extensions/Plugins/ZynFusion/lib/pkgconfig",
        "cppflags": "-I/app/extensions/Plugins/ZynFusion/include"
    },
    "modules": [
        "shared-modules/linux-audio/fftw3f-static.json",
        "shared-modules/linux-audio/liblo-static.json",
        "shared-modules/linux-audio/dssi.json",
        "shared-modules/linux-audio/lv2.json",
        "shared-modules/python2.7/python-2.7.json",
        {
            "name": "libmxml",
            "buildsystem": "autotools",
            "build-options": {
                "env": {
                    "CFLAGS": "-fPIC"
                }
            },
            "config-opts": [
                "--disable-shared"
            ],
            "cleanup": [
                "*.a",
                "/lib/pkgconfig",
                "/share",
                "/include"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/michaelrsweet/mxml/releases/download/v3.1/mxml-3.1.tar.gz",
                    "sha256": "1ac8d252f62f9dc2b2004518c70d2da313bdfcd92b8350e215f46064a34b52fc"
                }
            ]
        },
        {
            "name": "libuv",
            "build-options": {
                "cflags": "-fPIC"
            },
            "config-opts": [
                "--disable-shared",
                "--enable-static"
            ],
            "cleanup": [
                "/include",
                "/lib/pkgconfig",
                "*.a",
                "*.la"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url":"http://dist.libuv.org/dist/v1.9.1/libuv-v1.9.1.tar.gz",
                    "sha256": "e83953782c916d7822ef0b94e8115ce5756fab5300cca173f0de5f5b0e0ae928"
                }
            ]
        },
        {
            "name": "zest",
            "buildsystem": "simple",
            "build-commands": [
                "ruby rebuild-fcache.rb",
                "make clean",
                "rm -f package/qml/*.qml",
                "ruby rebuild-fcache.rb",
                "make"
            ],
            "build-options": {
                "env": {
                    "CFLAGS": "-I/app/extensions/Plugins/ZynFusion/include",
                    "VERSION": "3.0.6",
                    "BUILD_MODE": "release"
                }
            },
            "post-install": [
                "install -d $FLATPAK_DEST/lib/qml",
                "touch $FLATPAK_DEST/lib/qml/MainWindow.qml",
                "install -d $FLATPAK_DEST/lib/schema",
                "install src/osc-bridge/schema/test.json $FLATPAK_DEST/lib/schema",
                "install -d $FLATPAK_DEST/lib/font",
                "install -D deps/nanovg/example/*.ttf $FLATPAK_DEST/lib/font",
                "strip mruby/bin/mruby",
                "install mruby/bin/mruby $FLATPAK_DEST/lib",
                "strip libzest.so",
                "install libzest.so $FLATPAK_DEST/lib",
                "strip zest",
                "install zest $FLATPAK_DEST/lib"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/mruby-zest/mruby-zest-build",
                    "tag": "3.0.6",
                    "commit": "dd3d45ba333011f2359e86f9a758d9836e53fe5f"
                },
                {
                    "type": "patch",
                    "path": "zest_build-fixes.patch"
                }
            ]
        },
        {
            "name": "zynadsubfx",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DPluginLibDir=${FLATPAK_DEST}",
                "-DGuiModule=zest",
                "-DDemoMode=false",
                "-DZYN_DATADIR:STRING=/app/extensions/Plugins/ZynFusion/share/zynaddsubfx"
            ],
            "build-options": {
                "env": {
                    "LDFLAGS": "-lm"
                }
            },
            "cleanup": [
                "/bin",
                "/share/bash-completion",
                "/share/doc",
                "/share/applications"
            ],
            "post-install": [
                "ln -sf vst $FLATPAK_DEST/lxvst",
                "strip ${FLATPAK_DEST}/dssi/*.so",
                "strip ${FLATPAK_DEST}/vst/*.so",
                "strip ${FLATPAK_DEST}/lv2/*.lv2/*.so",
                "install -Dm644 --target-directory=${FLATPAK_DEST}/share/metainfo org.freedesktop.LinuxAudio.Plugins.ZynFusion.metainfo.xml",
                "appstream-compose --basename=org.freedesktop.LinuxAudio.Plugins.ZynFusion --prefix=${FLATPAK_DEST} --origin=flatpak org.freedesktop.LinuxAudio.Plugins.ZynFusion",
                "install -Dm644 -t $FLATPAK_DEST/share/licenses/zynadsubfx/ COPYING"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://download.sourceforge.net/sourceforge/zynaddsubfx/zynaddsubfx/3.0.6/zynaddsubfx-3.0.6.tar.bz2",
                    "sha256": "cbd160778f6cf147f9b0487719edc5197a1404f46d7c7bfd89e153f0d8ce71ae"
                },
                {
                    "type": "file",
                    "path": "org.freedesktop.LinuxAudio.Plugins.ZynFusion.metainfo.xml"
                }
            ]
        }
    ]
}
